// Magic Mod v3.2 - Canva Entegrasyon İyileştirmesi
const magicMod = {
    version: "3.2",
    isActive: true,
    
    init() {
        this.bindEvents();
        console.log(`Magic Mod v${this.version} aktif. Dış tık algılama devrede.`);
    },

    bindEvents() {
        // Yazı yazdıktan sonra dışarı tıklandığında moddan çıkış yap
        document.addEventListener('mousedown', (e) => {
            const editorPanel = document.getElementById('magic-editor-panel');
            const isClickInside = editorPanel?.contains(e.target);

            if (!isClickInside && this.isActive) {
                this.closeMagicMod();
            }
        });

        // ESC tuşuyla hızlı çıkış desteği
        document.addEventListener('keydown', (e) => {
            if (e.key === "Escape") this.closeMagicMod();
        });
    },

    closeMagicMod() {
        this.isActive = false;
        const panel = document.getElementById('magic-editor-panel');
        if (panel) {
            panel.style.display = 'none';
            // Canva canvas'ına odağı geri ver
            document.querySelector('.canva-canvas-container')?.focus();
        }
        console.log("Magic Mod v3.2: Dış tık algılandı, mod kapatıldı.");
    }
};

magicMod.init();
